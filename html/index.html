<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="../css/aaa.css" />
    <title>Document</title>
  <body>
    <button id="comecar">Clique para iniciar</button>
    <div id="instrucao">(Teclado: WASD ou setinhas)</div>
    <div  id="bordaextra">
      <div id="paredeesq"></div>
      <div id="paredecima"></div>
      <div id="parededir"></div>
      <div class="info" id="info">
      <div id="vida">VIDA: 100</div>
      <div id="pontos">PONTOS: </div>
    </div>
      <div class="bordas" id="bordas">
        <div id="personagem"></div>
      </div>
    </div>
    <div class="controles">
      <button type="button" id="cima">▲</button><br />
      <button type="button" id="esquerda">◄</button>
      <button type="button" id="direita">►</button><br />
      <button type="button" id="baixo">▼</button>
    </div>
    <script>
      let cima = document.querySelector("#cima");
      let esquerda = document.querySelector("#esquerda");
      let direita = document.querySelector("#direita");
      let baixo = document.querySelector("#baixo");
      let bordas = document.querySelector("#bordas");
      let bordaextra = document.querySelector("#bordaextra")
      let paredeesq = document.querySelector("#paredeesq")
      let info = document.querySelector("#info")
      let projeti1width
      let intervaldireita;
      let intervalesquerda;
      let intervalcima;
      let intervalbaixo;
      let personagem = document.querySelector("#personagem");
      let vida = 100;
      let pontos = 0;
      let intervalopontos;
      let atk1 = []
      let atk2 = []
      let atk3 = []
      let atk4 = []
      let atk5total = []
      let i1 = 0;
      let i2 = 0;
      let i3 = 0;
      let i4 = 0;
      let i5 = 0;
      let lockcima = 0, lockbaixo = 0, lockesquerda = 0, lockdireita = 0;
      let pvelocidade
      let colisao1, colisao2, colisao3, colisao4, colisao5;
      let pleft, ptop
      let podemexer = 0;
      let comecaatk
      let invencibilidade = 0;
      let ataques = []
      let selecionaratk
      let acabou = 0;
      let intervalovida
      let linha = 0;
      let ataqueanterior;
      let tempopcomecar = 1000
      if (window.innerWidth >= 600){
      personagem.style.left = "26vh";
      personagem.style.top = "27vh"
      personagem.style.width = "3vh";
      personagem.style.height = "3vh";
      bordas.style.width = "55vh";
      bordas.style.height = "55vh";
      paredeesq.style.width = "3.3vh";
      bordaextra.style.width = "62vh";
      bordaextra.style.height = "65vh";
      projetil1width = 3;
      pvelocidade = 0.5
      }
      else{
      personagem.style.left = "18vh";
      personagem.style.top = "18vh"
      personagem.style.width = "2vh";
      personagem.style.height = "2vh";
      bordas.style.width = "38vh";
      bordas.style.height = "38vh";
      paredeesq.style.width = "2.4vh";
      bordaextra.style.width = "43vh";
      bordaextra.style.height = "46vh";
      projetil1width = 2; 
      pvelocidade = 0.4
      }
      let pwidth = parseFloat(getComputedStyle(personagem).width)
      let paredeesqwidth = parseFloat(getComputedStyle(paredeesq).width)
      let paredecimaheight = parseFloat(getComputedStyle(paredecima).height)

      esquerda.addEventListener("mouseout",()=>{
          clearInterval(intervalesquerda)
          lockesquerda = 0;
        })

        direita.addEventListener("mouseout",()=>{
          clearInterval(intervaldireita)
          lockdireita = 0;
        })

        baixo.addEventListener("mouseout",()=>{
          clearInterval(intervalbaixo)
          lockbaixo = 0;
        });

        cima.addEventListener("mouseout",()=>{
          clearInterval(intervalcima)
          lockcima = 0;
        })

      //FUNÇAO DIREITA---------------------------------------------------------------------------------------
      function vaipradireita() {
        if (parseFloat(personagem.style.left) + parseFloat(personagem.style.width) < parseFloat(bordas.style.width) && podemexer == 1) {
          personagem.style.left = parseFloat(personagem.style.left) + pvelocidade + "vh";
        }
        
      }
      //FUNÇAO ESQUERDA---------------------------------------------------------------------------------------
      function vaipraesquerda() {
        if (parseFloat(personagem.style.left) > 0 && podemexer == 1) {
          personagem.style.left = parseFloat(personagem.style.left) - pvelocidade + "vh";
        }

      }
      //FUNÇAO CIMA---------------------------------------------------------------------------------------
      function vaipracima() {
        if (parseFloat(personagem.style.top) > 0 && podemexer == 1) {
          personagem.style.top = parseFloat(personagem.style.top) - pvelocidade + "vh";
        }
        
      }
      //FUNÇAO BAIXO---------------------------------------------------------------------------------------
      function vaiprabaixo() {
        if (parseFloat(personagem.style.top) + parseFloat(personagem.style.width) < parseFloat(bordas.style.height) && podemexer == 1) {
          personagem.style.top = parseFloat(personagem.style.top) + pvelocidade + "vh";
        }
        
      }
      //DIREITA---------------------------------------------------------------------------------------
      direita.addEventListener("mousedown", () => {
        if (lockdireita == 0){
        intervaldireita = setInterval(vaipradireita, 12);
        lockdireita = 1;
      }
      });
      direita.addEventListener("mouseup", () => {
        if (lockdireita == 1){
        clearInterval(intervaldireita);
        lockdireita = 0;
      }
      });
      direita.addEventListener("touchstart", () => {
        if (lockdireita == 0){
        intervaldireita = setInterval(vaipradireita, 12);
        lockdireita = 1;
      }
      });
      direita.addEventListener("touchend", () => {
        if (lockdireita == 1){
        clearInterval(intervaldireita);
        lockdireita = 0;
      }
      });

      //ESQUERDA---------------------------------------------------------------------------------------
      esquerda.addEventListener("mousedown", () => {
        if (lockesquerda == 0){
        intervalesquerda = setInterval(vaipraesquerda, 12);
        lockesquerda = 1
      }
      });
      esquerda.addEventListener("mouseup", () => {
        if (lockesquerda == 1){
        clearInterval(intervalesquerda);
        lockesquerda = 0
        }
      });
      esquerda.addEventListener("touchstart", () => {
        if (lockesquerda == 0){
        intervalesquerda = setInterval(vaipraesquerda, 12);
        lockesquerda = 1
      }
      });
      esquerda.addEventListener("touchend", () => {
        if (lockesquerda == 1){
        clearInterval(intervalesquerda);
        lockesquerda = 0
        }
      });

      //CIMA---------------------------------------------------------------------------------------
      cima.addEventListener("mousedown", () => {
        if (lockcima == 0){
        intervalcima = setInterval(vaipracima, 12);
        lockcima = 1;
      }
      });
      cima.addEventListener("mouseup", () => {
        if (lockcima == 1){
        clearInterval(intervalcima);
        lockcima = 0;
      }
      });
      cima.addEventListener("touchstart", () => {
        if (lockcima == 0){
        intervalcima = setInterval(vaipracima, 12);
        lockcima = 1;
      }
      });
      cima.addEventListener("touchend", () => {
        if (lockcima == 1){
        clearInterval(intervalcima);
        lockcima = 0;
        }
      });

      //BAIXO---------------------------------------------------------------------------------------
      baixo.addEventListener("mousedown", () => {
        if (lockbaixo == 0){
        intervalbaixo = setInterval(vaiprabaixo, 12);
        lockbaixo = 1
      }
      });
      baixo.addEventListener("mouseup", () => {
        if (lockbaixo == 1){
        clearInterval(intervalbaixo);
        lockbaixo = 0;
      }
      });
      baixo.addEventListener("touchstart", () => {
        if (lockbaixo == 0){
        intervalbaixo = setInterval(vaiprabaixo, 12);
        lockbaixo = 1
      }
      });
      baixo.addEventListener("touchend", () => {
        if (lockbaixo == 1){
        clearInterval(intervalbaixo);
        lockbaixo = 0;
        }
      });
      //TECLADO----------------------------------------------------------------------
      document.addEventListener("keydown",(e)=>{
        if(e.keyCode == 65 || e.keyCode == 37){         
          if (lockesquerda == 0){
        intervalesquerda = setInterval(vaipraesquerda, 12);
        lockesquerda = 1
      }
        }
      if (e.keyCode == 68 || e.keyCode == 39){
        if (lockdireita == 0){
        intervaldireita = setInterval(vaipradireita, 12);
        lockdireita = 1;
      }
      }
      if (e.keyCode == 87 || e.keyCode == 38){
        if (lockcima == 0){
        intervalcima = setInterval(vaipracima, 12);
        lockcima = 1;
      }
    }
    if (e.keyCode == 83 || e.keyCode == 40){
      if (lockbaixo == 0){
        intervalbaixo = setInterval(vaiprabaixo, 12);
        lockbaixo = 1
      }
    }
      })
      //SOLTAR TECLA
      document.addEventListener("keyup",(e)=>{

        if(e.keyCode == 65 || e.keyCode == 37){
          if (lockesquerda == 1){
        clearInterval(intervalesquerda);
        lockesquerda = 0
        }
        }
      if (e.keyCode == 68 || e.keyCode == 39){
        if (lockdireita == 1){
        clearInterval(intervaldireita);
        lockdireita = 0;
      }
      }
      if (e.keyCode == 87 || e.keyCode == 38){
        if (lockcima == 1){
        clearInterval(intervalcima);
        lockcima = 0;
      }
    }
    if (e.keyCode == 83 || e.keyCode == 40){
      if (lockbaixo == 1){
        clearInterval(intervalbaixo);
        lockbaixo = 0;
      }
    }
      })


      //FUNCAO ATAQUE1----------------------------------------------------------------------
      function ataque1(){
    atk1[i1] = document.createElement("div");
    atk1[i1].setAttribute("id","projetil1");
    atk1[i1].style.left =  Math.random() * (parseFloat(bordaextra.style.width) - (parseFloat(paredeesq.style.width) * 2) - projetil1width) + parseFloat(paredeesq.style.width) + "vh";
        if (i1 > 1){
    if (parseFloat(atk1[i1].style.left) < parseFloat(atk1[i1-1].style.left) + projetil1width && parseFloat(atk1[i1].style.left) + projetil1width > parseFloat(atk1[i1 - 1].style.left)){
      atk1.pop().remove()
      ataque1()
      return;
    }
    }
    bordaextra.appendChild(atk1[i1]);
    removeprojetil(atk1,1200)
    i1++
   }
      //FUNCAO ATAQUE2----------------------------------------------------------------------
      function ataque2(){
        atk2[i2] = document.createElement("div");
        atk2[i2].setAttribute("id","projetil2")
        atk2[i2].style.height = Math.random() * (parseFloat(getComputedStyle(bordaextra).height) - parseFloat(getComputedStyle(info).height) * 2 -
        parseFloat(getComputedStyle(paredecima).height)) + (parseFloat(getComputedStyle(paredecima).height) * 1.05) + "px"
        bordaextra.appendChild(atk2[i2])
        removeprojetil(atk2,2500)
        i2++
        atk2[i2] = document.createElement("div");
        atk2[i2].setAttribute("id","projetil2")
        atk2[i2].style.top = parseFloat(atk2[i2 - 1].style.height) + (parseFloat(getComputedStyle(personagem).height) * 2.05) + "px";
        atk2[i2].style.height = parseFloat(getComputedStyle(bordaextra).height) - parseFloat(atk2[i2].style.top) + "px"
        bordaextra.appendChild(atk2[i2]);
        removeprojetil(atk2,2500)
        i2++
      }
      //FUNCAO ATAQUE3----------------------------------------------------------------------
      function ataque3(){
        let posicaopjt3
        
        if (linha == 0) {
          posicaopjt3 = paredeesqwidth;
          linha = 1
        }
        else {
          posicaopjt3 = paredeesqwidth + (pwidth * 1.5)
          linha = 0
        }      
        for (; posicaopjt3 <= parseFloat(getComputedStyle(bordaextra).width) - paredeesqwidth;){
        atk3[i3] = document.createElement("div");
        atk3[i3].setAttribute("id","projetil3");
        atk3[i3].style.left = posicaopjt3 + "px"
        posicaopjt3 += pwidth * 3
        bordaextra.appendChild(atk3[i3])
        removeprojetil(atk3,2000);
        i3++
        }
      }
      //FUNCAO ATAQUE4----------------------------------------------------------------------
      function ataque4(){
        let duracaoanim = (Math.random() * 1.1) + 0.5;
        atk4[i4] = document.createElement("div");
        atk4[i4].setAttribute("id", "projetil4");
        atk4[i4].style.animation = "atk4-1 linear 7.5s, atk4-2 linear infinite alternate " + duracaoanim + "s";
        atk4[i4].style.left = Math.random() * paredeesqwidth * 2 + "px"
        bordaextra.appendChild(atk4[i4]);
        removeprojetil(atk4, 7500)
        i4++
        duracaoanim = Math.random() + 1;
        atk4[i4] = document.createElement("div");
        atk4[i4].setAttribute("id", "projetil4");
        atk4[i4].style.animation = "atk4-1 linear 8s, atk4-2 linear infinite alternate-reverse " + duracaoanim + "s";
        atk4[i4].style.left = Math.random() * paredeesqwidth * 2 + "px"
        bordaextra.appendChild(atk4[i4]);
        removeprojetil(atk4, 8000)
        i4++
      }


async function delay(ml) {
     return new Promise(resolve => {
          setTimeout(resolve, ml);
     });
};
      //FUNCAO ATAQUE5----------------------------------------------------------------------
     async function ataque5(){
       let atk5 = document.createElement("div");
        atk5.setAttribute("class","projetil5")
      let ladoataque5 = Math.floor(Math.random() * 4) 
        switch(ladoataque5){
          case 0:
            atk5.style.left = "2px"
            atk5.style.top = Math.random() * 85 + 5 + "%"                     
            break;

          case 1:
            atk5.style.left = "95%"
            atk5.style.top = Math.random() * 85 + 5 + "%"           
            break;

          case 2:
            atk5.style.left = Math.random() * 85 + 5 + "%"
            atk5.style.top = "2px"           
            break;

          case 3:
            atk5.style.left = Math.random() * 85 + 5 + "%"
            atk5.style.top = "92%"            
            break;
        }
          bordaextra.appendChild(atk5)
          await delay(500);
          let posxp = parseFloat(getComputedStyle(personagem).left) + (parseFloat(getComputedStyle(personagem).width) / 2)
          let posyp = parseFloat(getComputedStyle(personagem).top) + (parseFloat(getComputedStyle(personagem).height) / 2)  
          let posxt = parseFloat(getComputedStyle(atk5).left) + (parseFloat(getComputedStyle(atk5).width) / 2) - paredeesqwidth
          let posyt = parseFloat(getComputedStyle(atk5).top) + (parseFloat(getComputedStyle(atk5).height) / 2) - paredecimaheight
          let distx = posxp - posxt;
          let disty = posyp - posyt
          let hipotenusa = Math.sqrt(distx**2 + disty**2)
          
         
      while(parseFloat(getComputedStyle(atk5).left) >= 0 && 
      parseFloat(getComputedStyle(atk5).left) < parseFloat(getComputedStyle(bordaextra).width)&&
      parseFloat(getComputedStyle(atk5).top) >= 0 && 
      parseFloat(getComputedStyle(atk5).top) <= parseFloat(getComputedStyle(bordaextra).height)){        
           
        atk5.style.left = parseFloat(getComputedStyle(atk5).left) + (distx / hipotenusa) * 1.2 + "px"
        atk5.style.top = parseFloat(getComputedStyle(atk5).top) + (disty / hipotenusa) * 1.2 + "px"

        await delay(5)
          
      }        
            atk5.style.animation = "atk5-3 0.5s linear";
      await delay(500)
      atk5.remove()
    }
      //FUNCAO REMOVEPROJETIL----------------------------------------------------------------------
      function removeprojetil(nprojetil,tempo){
    setTimeout(()=>{
    nprojetil.shift().remove()
    if (nprojetil == atk1) i1--;
    if (nprojetil == atk2) i2--;
    if (nprojetil == atk3) i3--;
    if (nprojetil == atk4) i4--;
    },tempo)
   }
   //FUNCAO PARAATAQUE-----------------------------------------------------------------------------
      function paraataque(nataque){
        clearInterval 
      }

    //FUNCAO TOMOUDANO-----------------------------------------------------------------------------
      function tomoudano(){  
            personagem.setAttribute("class","animacaodano")     
            let audio = new Audio('../sons/dano.mp3');
             audio.volume = 0.05       
				    audio.play();
						vida = vida - 10
            document.querySelector("#vida").textContent = "VIDA: " + vida; 
      }
     //FUNCAO PEGATOPLEFT DO PERSONAGEM-----------------------------------------------------------------------------
     function pegatopleft(){
      pleft = parseFloat(getComputedStyle(personagem).left)
       ptop = parseFloat(getComputedStyle(personagem).top)
     }
     //FUNCAO COLISAOATK-----------------------------------------------------------------------------
     function colisao(atk){
        pegatopleft()
      for (let a = 0; a < atk.length; a++){
        let projetilwidth = parseFloat(getComputedStyle(atk[a]).width)
      let projetilleft = parseFloat(getComputedStyle(atk[a]).left)
      let projetiltop = parseFloat(getComputedStyle(atk[a]).top)
      let projetilheight = parseFloat(getComputedStyle(atk[a]).height)
      if (pleft < projetilleft + projetilwidth - paredeesqwidth && pleft + pwidth > projetilleft - paredeesqwidth &&
		      ptop < projetiltop + projetilheight - paredecimaheight && ptop + pwidth > projetiltop - paredecimaheight) {
            if (invencibilidade == 0){
            tomoudano()
            invencibilidade = 1
            setTimeout(()=>{
              personagem.removeAttribute("class")
              invencibilidade = 0;
            },750)
          }
            
            
    }
  }
}   
      function verificarecomeco(){
        if (vida > 0 && acabou == 0){
              jogo()
             }
      }
      function verificavida(){
        if (vida <= 0){          
          podemexer = 0;
          clearInterval(intervalopontos)
          clearInterval(intervalovida)
          clearInterval(comecaatk)
          personagem.remove();
          let botao = document.createElement("button");
          botao.setAttribute("id","comecar");
          botao.textContent = "Recomeçar"
          document.body.appendChild(botao);
          botao.addEventListener("click",()=>{
            window.location.reload();
          })
          fimdejogo()
        }
      }
            document.querySelector("#comecar").addEventListener("click",comecarjogo);

            function comecarjogo(){
              podemexer = 1;
              document.querySelector("#comecar").remove()
              document.querySelector("#instrucao").remove()
              jogo()
              intervalovida = setInterval(verificavida,40)
              intervalopontos = setInterval(()=>{
                pontos++
                document.querySelector("#pontos").textContent = "PONTOS: " + pontos; 
              },1000)
            }

                function jogo(){
                  if (ataques.length == 0){             
                  ataques = [ataque1,ataque2,ataque3,ataque4,ataque5]
                  }
                selecionaratk = Math.round(Math.random() * (ataques.length - 1))
                if (ataques[selecionaratk] != ataque1){
                setTimeout(()=>{
                  clearInterval(colisao1)
                },1200)     
              }            
                if (ataques[selecionaratk] != ataque2){
                setTimeout(()=>{
                  clearInterval(colisao2)
                },2500) 
              }
                  if (ataques[selecionaratk] != ataque3) {
                    setTimeout(() => {
                      clearInterval(colisao3)
                    }, 2000)
                  }    
                  if (ataques[selecionaratk] != ataque4) {
                    setTimeout(() => {
                      clearInterval(colisao4)
                    }, 8000)
                  }
                    if (ataques[selecionaratk] != ataque5) {
                    setTimeout(() => {
                      clearInterval(colisao5)
                    }, 4000)
                  }
                  if (ataqueanterior == "ataque1"){
                    tempopcomecar = 1300
                  }       

                    if (ataqueanterior == "ataque2"){
                      tempopcomecar = 2500;
                  }

                  if (ataqueanterior == "ataque3"){
                    tempopcomecar = 1800
                  }

                  if (ataqueanterior == "ataque4"){
                      tempopcomecar = 7200;
                    }

                  if (ataqueanterior == "ataque5"){
                    tempopcomecar = 3800
                  }    

                if (ataques[selecionaratk] == ataque1){
                  ataqueanterior = "ataque1"
                 colisao1 = setInterval(colisao,10,atk1)
                setTimeout(()=>{
                comecaatk = setInterval(ataque1,75)
                 },tempopcomecar)
                 setTimeout(()=>{
                  clearInterval(comecaatk)
                  ataques.splice(selecionaratk,1)               
                  verificarecomeco()
                 },15000 + tempopcomecar)
                }
                if (ataques[selecionaratk] == ataque2){
                  ataqueanterior = "ataque2"
                 colisao2 = setInterval(colisao,10,atk2)
                setTimeout(()=>{
                comecaatk = setInterval(ataque2,1050)
                 },tempopcomecar)
                 setTimeout(()=>{
                  clearInterval(comecaatk)
                  ataques.splice(selecionaratk,1)
                  verificarecomeco()
                 },18000 + tempopcomecar)
                }
                     if (ataques[selecionaratk] == ataque3){
                      ataqueanterior = "ataque3"
                 colisao3 = setInterval(colisao,10,atk3)
                setTimeout(()=>{
                comecaatk = setInterval(ataque3,370)
                 },tempopcomecar)
                 setTimeout(()=>{
                  clearInterval(comecaatk)
                  ataques.splice(selecionaratk,1)                  
                  verificarecomeco()
                 },10000 + tempopcomecar)       
              }
              if (ataques[selecionaratk] == ataque4) {
                ataqueanterior = "ataque4"
                    colisao4 = setInterval(colisao, 10, atk4)
                    setTimeout(() => {
                      comecaatk = setInterval(ataque4, 1300)
                    }, tempopcomecar)
                    setTimeout(() => {
                      clearInterval(comecaatk)
                      ataques.splice(selecionaratk, 1)
                      verificarecomeco()
                    }, 20000 + tempopcomecar)
                  }
                  if (ataques[selecionaratk] == ataque5) {
                    ataqueanterior = "ataque5"     
                    colisao5 = setInterval(colisao, 10, atk5total = document.getElementsByClassName("projetil5"));         
                    setTimeout(() => {
                      comecaatk = setInterval(ataque5, 350)
                    }, tempopcomecar)
                    setTimeout(() => {
                      clearInterval(comecaatk)
                      ataques.splice(selecionaratk, 1)
                      verificarecomeco()
                    }, 20000 + tempopcomecar)
                  }
            }
              function fimdejogo(){
                alert("Você fez "+pontos +" pontos.")
              }


    </script>
  </body>
</html>
